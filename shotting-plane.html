<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Quidditch Seeker | Final Fix</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #000; color: #d4af37; font-family: 'Cinzel Decorative', cursive; overflow: hidden; }
        #ui { position: absolute; top: 10px; width: 100%; display: flex; justify-content: space-around; font-size: 20px; z-index: 10; text-shadow: 2px 2px #000; }
        canvas { display: block; background: radial-gradient(circle, #1a1b3a, #000); }
    </style>
</head>
<body>
    <div id="ui">
        <span>SCORE: <span id="score">0</span></span>
        <span>MANA: <span id="mana">100</span></span>
    </div>
    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let score = 0;
        let player = { x: 100, y: canvas.height/2, w: 80, h: 30 };
        let bullets = [];
        let enemies = [];
        let keys = {};

        window.onkeydown = e => keys[e.code] = true;
        window.onkeyup = e => keys[e.code] = false;

        function update() {
            if (keys['ArrowUp'] && player.y > 50) player.y -= 7;
            if (keys['ArrowDown'] && player.y < canvas.height - 50) player.y += 7;
            if (keys['Space']) {
                bullets.push({ x: player.x + 80, y: player.y + 15 });
                keys['Space'] = false; // 防止連發
            }

            // 咒語邏輯
            bullets.forEach((b, bi) => {
                b.x += 12;
                if (b.x > canvas.width) bullets.splice(bi, 1);
            });

            // 敵方博格邏輯
            if (Math.random() < 0.04) {
                enemies.push({ x: canvas.width, y: Math.random() * (canvas.height - 60) + 30, r: 20 });
            }

            enemies.forEach((e, ei) => {
                e.x -= 6;
                
                // --- 碰撞偵測（修復核心） ---
                bullets.forEach((b, bi) => {
                    // 計算咒語同敵人之間嘅距離
                    let dist = Math.hypot(b.x - e.x, b.y - e.y);
                    if (dist < e.r + 10) { // 如果距離細過半徑，即係打中
                        enemies.splice(ei, 1);
                        bullets.splice(bi, 1);
                        score += 10;
                        document.getElementById('score').innerText = score;
                    }
                });

                if (e.x < -30) enemies.splice(ei, 1);
            });
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 畫玩家（飛天掃帚）
            ctx.fillStyle = "#8b4513";
            ctx.fillRect(player.x, player.y + 10, 60, 10);
            ctx.fillStyle = "#d4af37";
            ctx.beginPath();
            ctx.moveTo(player.x, player.y + 15);
            ctx.lineTo(player.x - 30, player.y);
            ctx.lineTo(player.x - 30, player.y + 30);
            ctx.fill();

            // 畫咒語
            ctx.fillStyle = "#00f3ff";
            ctx.shadowBlur = 10; ctx.shadowColor = "#00f3ff";
            bullets.forEach(b => {
                ctx.beginPath(); ctx.arc(b.x, b.y, 6, 0, Math.PI*2); ctx.fill();
            });

            // 畫敵人（博格）
            ctx.fillStyle = "#444";
            ctx.shadowColor = "red";
            enemies.forEach(e => {
                ctx.beginPath(); ctx.arc(e.x, e.y, e.r, 0, Math.PI*2); ctx.fill();
                ctx.strokeStyle = "white"; ctx.stroke();
            });

            ctx.shadowBlur = 0;
            update();
            requestAnimationFrame(draw);
        }
        draw();
    </script>
</body>
</html>