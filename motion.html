<!DOCTYPE html>
<html>
<head>
    <title>Hand Tracking Motion Game</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; }
        canvas { border: 2px solid #0ff; border-radius: 10px; }
        #video { transform: scaleX(-1); position: fixed; top: 10px; right: 10px; width: 160px; height: 120px; border: 2px solid #555; }
        .info { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="info">
        <h2>Hand Motion Paddle</h2>
        <p>Score: <span id="score">0</span></p>
        <p>Status: <span id="status">Loading Camera...</span></p>
    </div>

    <video id="video" autoplay playsinline></video>
    <canvas id="gameCanvas"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        const videoElement = document.getElementById('video');
        const canvasElement = document.getElementById('gameCanvas');
        const canvasCtx = canvasElement.getContext('2d');
        const scoreElement = document.getElementById('score');
        const statusElement = document.getElementById('status');

        canvasElement.width = window.innerWidth;
        canvasElement.height = window.innerHeight;

        let score = 0;
        let paddleX = canvasElement.width / 2;
        let ball = { x: 100, y: 100, dx: 5, dy: 5, radius: 15 };

        // 1. Setup Hand Tracking
        const hands = new Hands({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
        });

        hands.setOptions({
            maxNumHands: 1,
            modelComplexity: 1,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });

        hands.onResults(onResults);

        // 2. Control Paddle with Hand
        function onResults(results) {
            statusElement.innerText = "Tracking Active";
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const hand = results.multiHandLandmarks[0];
                // Use index finger (landmark 8) to move paddle
                // Mirror the X coordinate
                paddleX = (1 - hand[8].x) * canvasElement.width;
            }
        }

        const camera = new Camera(videoElement, {
            onFrame: async () => { await hands.send({image: videoElement}); },
            width: 640, height: 480
        });
        camera.start();

        // 3. Game Logic & Animation
        function draw() {
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);

            // Draw Ball
            canvasCtx.beginPath();
            canvasCtx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
            canvasCtx.fillStyle = "#0ff";
            canvasCtx.fill();
            canvasCtx.closePath();

            // Draw Paddle
            canvasCtx.fillStyle = "#fff";
            canvasCtx.fillRect(paddleX - 75, canvasElement.height - 40, 150, 20);

            // Ball Movement
            ball.x += ball.dx;
            ball.y += ball.dy;

            // Walls
            if(ball.x + ball.radius > canvasElement.width || ball.x - ball.radius < 0) ball.dx *= -1;
            if(ball.y - ball.radius < 0) ball.dy *= -1;

            // Paddle Hit
            if(ball.y + ball.radius > canvasElement.height - 40) {
                if(ball.x > paddleX - 75 && ball.x < paddleX + 75) {
                    ball.dy *= -1;
                    score++;
                    scoreElement.innerText = score;
                } else if (ball.y > canvasElement.height) {
                    // Reset Game
                    ball.y = 100;
                    score = 0;
                    scoreElement.innerText = score;
                }
            }

            requestAnimationFrame(draw);
        }

        draw();
    </script>
</body>
</html>