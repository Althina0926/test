<!DOCTYPE html>
<html>
<head>
    <title>Wand Mastery</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <style>
        body { margin: 0; background: #000; color: #d4af37; font-family: 'Cinzel Decorative', cursive; overflow: hidden; }
        #canvas-container { position: relative; width: 100vw; height: 100vh; }
        canvas { width: 100%; height: 100%; object-fit: cover; }
        .ui-overlay { position: absolute; top: 20px; left: 0; width: 100%; text-align: center; z-index: 10; pointer-events: none; }
        .start-btn { pointer-events: auto; background: #d4af37; border: none; padding: 15px 30px; font-family: inherit; font-size: 1.2rem; cursor: pointer; border-radius: 50px; box-shadow: 0 0 20px #d4af37; }
    </style>
</head>
<body>
    <div class="ui-overlay">
        <h1>魔杖練習場</h1>
        <button class="start-btn" onclick="initMagic()">✨ 握住你的魔杖 (點擊開始)</button>
    </div>
    <div id="canvas-container">
        <video id="input_video" style="display:none"></video>
        <canvas id="output_canvas"></canvas>
    </div>

    <script>
        const videoElement = document.getElementById('input_video');
        const canvasElement = document.getElementById('output_canvas');
        const canvasCtx = canvasElement.getContext('2d');

        function initMagic() {
            document.querySelector('.start-btn').style.display = 'none';
            const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
            hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7 });
            hands.onResults(onResults);
            const camera = new Camera(videoElement, {
                onFrame: async () => { await hands.send({image: videoElement}); },
                width: 1280, height: 720
            });
            camera.start();
        }

        function onResults(results) {
            canvasElement.width = window.innerWidth;
            canvasElement.height = window.innerHeight;
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
            
            // 背景深藍魔法色
            canvasCtx.fillStyle = "rgba(10, 10, 30, 0.8)";
            canvasCtx.fillRect(0,0, canvasElement.width, canvasElement.height);

            if (results.multiHandLandmarks) {
                for (const landmarks of results.multiHandLandmarks) {
                    // 指尖座標 (Landmark 8)
                    const x = (1 - landmarks[8].x) * canvasElement.width;
                    const y = landmarks[8].y * canvasElement.height;

                    // 1. 畫出魔法路徑
                    canvasCtx.shadowBlur = 30;
                    canvasCtx.shadowColor = "#ff3300";
                    let g = canvasCtx.createRadialGradient(x, y, 0, x, y, 40);
                    g.addColorStop(0, "white");
                    g.addColorStop(0.2, "#ff3300");
                    g.addColorStop(1, "transparent");
                    
                    canvasCtx.fillStyle = g;
                    canvasCtx.beginPath();
                    canvasCtx.arc(x, y, 40, 0, Math.PI*2);
                    canvasCtx.fill();

                    // 2. 咒語文字特效
                    canvasCtx.shadowBlur = 10;
                    canvasCtx.fillStyle = "white";
                    canvasCtx.font = "30px Cinzel Decorative";
                    canvasCtx.fillText("Expelliarmus!", x + 40, y - 20);
                }
            }
            canvasCtx.restore();
        }
    </script>
</body>
</html>